<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<style>
  /* Loading state */
  #loader { font-style: italic; color: #606c71; }

  /* Table enhancements for Cayman */
  table {
    width: 100%;
    display: table; /* Override Cayman's block display for better width control */
    margin-bottom: 2rem;
    border-collapse: collapse;
  }
  
  /* Rank Highlighting */
  tr.rank-1 { background-color: #fff8db; border-left: 4px solid #ffd700; }
  tr.rank-2 { border-left: 4px solid #c0c0c0; }
  tr.rank-3 { border-left: 4px solid #cd7f32; }

  /* Medal Icons */
  tr.rank-1 td:first-child::after { content: " ðŸ¥‡"; }
  tr.rank-2 td:first-child::after { content: " ðŸ¥ˆ"; }
  tr.rank-3 td:first-child::after { content: " ðŸ¥‰"; }

  /* Header styling to match Cayman */
  h2.group-header {
    margin-top: 3rem;
    border-bottom: 1px solid #e5e5e5;
    padding-bottom: 0.5rem;
    color: #159957; /* Cayman Green */
  }

  /* Mobile tweaks */
  @media (max-width: 600px) {
    .hide-mobile { display: none; }
    table { font-size: 0.9em; }
  }
</style>

<div id="leaderboard-container">
  <div id="loader">Henter data fra Google Sheets...</div>
</div>

<script>
  // --- CONFIGURATION ---
  // PASTE YOUR GOOGLE SHEET CSV LINK BELOW:
  const sheetURL = "YOUR_GOOGLE_SHEET_CSV_LINK_HERE";

  Papa.parse(sheetURL, {
    download: true,
    header: true,
    complete: function(results) {
      processData(results.data);
    }
  });

  function processData(data) {
    const container = document.getElementById('leaderboard-container');
    container.innerHTML = ""; 

    // 1. Filter empty rows
    data = data.filter(row => row['Hundens navn'] && row['rase']);

    // 2. Group by Rase + Farge
    const groups = {};
    data.forEach(row => {
      const rase = (row['rase'] || "").trim();
      const farge = (row['farge'] || "").trim();
      const key = `${rase} - ${farge}`;
      if (!groups[key]) groups[key] = [];
      groups[key].push(row);
    });

    // 3. Sort Groups Alphabetically
    const sortedKeys = Object.keys(groups).sort();

    sortedKeys.forEach(groupKey => {
      // 4. Sort dogs by Points (Descending)
      const dogs = groups[groupKey].sort((a, b) => Number(b['Poeng']) - Number(a['Poeng']));
      createTable(container, groupKey, dogs);
    });
  }

  function createTable(container, title, dogs) {
    // Header
    const h2 = document.createElement('h2');
    h2.className = 'group-header';
    h2.textContent = title;
    container.appendChild(h2);

    // Table
    const table = document.createElement('table');
    let html = `
      <thead>
        <tr>
          <th width="10%">#</th>
          <th width="15%">Poeng</th>
          <th>Hundens navn</th>
          <th class="hide-mobile">Reg. nr</th>
        </tr>
      </thead>
      <tbody>
    `;

    dogs.forEach((dog, index) => {
      const rank = index + 1;
      const rankClass = rank <= 3 ? `rank-${rank}` : '';
      const titles = dog['Hundens titler'] ? `<br><small style="color:#666">${dog['Hundens titler']}</small>` : '';

      html += `
        <tr class="${rankClass}">
          <td>${rank}</td>
          <td><strong>${dog['Poeng']}</strong></td>
          <td>${dog['Hundens navn']} ${titles}</td>
          <td class="hide-mobile"><small>${dog['Hundens reg. nr']}</small></td>
        </tr>
      `;
    });

    html += `</tbody>`;
    table.innerHTML = html;
    container.appendChild(table);
  }
</script>
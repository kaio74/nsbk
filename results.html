---
layout: default
title: Resultater
---

<style>
  /* Tab Navigation */
  .tab-nav { overflow: hidden; border-bottom: 1px solid #ccc; margin-bottom: 20px; }
  .tab-nav a { float: left; display: block; color: #159957; text-align: center; padding: 14px 16px; text-decoration: none; font-size: 17px; border: 1px solid transparent; border-bottom: none; }
  .tab-nav a:hover { background-color: #f1f1f1; }
  .tab-nav a.active { background-color: #fff; border: 1px solid #ccc; border-bottom: 2px solid white; font-weight: bold; color: #000; margin-bottom: -1px; }

  /* Loader & Timestamp */
  #loader { font-style: italic; color: #606c71; text-align: center; margin-top: 20px; }
  #last-updated { text-align: right; font-size: 0.85rem; color: #606c71; margin-bottom: 1rem; font-style: italic; }

  /* Table Layout */
  table { width: 100%; display: table; margin-bottom: 2rem; border-collapse: collapse; }
  th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
  th { background-color: #f9f9f9; font-weight: bold; }

  /* Medals & Rankings */
  tr.rank-1 { background-color: #fff8db; border-left: 4px solid #ffd700; }
  tr.rank-2 { border-left: 4px solid #c0c0c0; }
  tr.rank-3 { border-left: 4px solid #cd7f32; }
  
  /* Medal Icons */
  tr.rank-1 td:first-child::after { content: " ðŸ¥‡"; }
  tr.rank-2 td:first-child::after { content: " ðŸ¥ˆ"; }
  tr.rank-3 td:first-child::after { content: " ðŸ¥‰"; }

  /* Group Header */
  h2.group-header { margin-top: 3rem; border-bottom: 1px solid #e5e5e5; padding-bottom: 0.5rem; color: #159957; }

  /* Mobile Tweaks */
  @media (max-width: 600px) { 
    .hide-mobile { display: none; }
    table { font-size: 0.9em; }
    th, td { padding: 8px 4px; }
    #last-updated { text-align: center; }
  }
</style>

<div class="tab-nav">
  <a href="./index.html">PÃ¥melding</a>
  <a href="./results.html" class="active">Resultater</a>
</div>

<h2>Resultater fra Ã¥rskonkurrasene</h2>
<p>Resultatene er gruppert etter rase og farge.</p>

<div id="last-updated"></div>

<div id="leaderboard-container">
  <div id="loader">Henter data fra Google Sheets...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
  // ******************************************************
  // VIKTIG: LIM INN DIN CSV-LENKE HER
  // ******************************************************
  const sheetURL = "YOUR_GOOGLE_SHEET_CSV_LINK_HERE";

  Papa.parse(sheetURL, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
      if (results.data && results.data.length > 0) {
        processData(results.data);
        updateTimestamp();
      } else {
        document.getElementById('loader').innerHTML = "Fant ingen data. Sjekk lenken.";
      }
    },
    error: function(err) {
        console.error("Error:", err);
        document.getElementById('loader').innerHTML = "Kunne ikke laste data (Network Error).";
    }
  });

  // Function: Update Timestamp
  function updateTimestamp() {
    const now = new Date();
    const dateString = now.toLocaleDateString('no-NO', { day: '2-digit', month: '2-digit', year: 'numeric' });
    const timeString = now.toLocaleTimeString('no-NO', { hour: '2-digit', minute: '2-digit' });
    
    const tsDiv = document.getElementById('last-updated');
    if(tsDiv) tsDiv.innerHTML = `Sist oppdatert: ${dateString} kl. ${timeString}`;
  }

  // Function: Process and Display Data
  function processData(data) {
    const container = document.getElementById('leaderboard-container');
    container.innerHTML = ""; 

    // Filter: Ensure rows have a Name and a Breed
    const validData = data.filter(row => row['Hundens navn'] && row['rase']);

    if (validData.length === 0) {
        container.innerHTML = "<p>Fant data, men ingen gyldige rader (sjekk kolonnenavnene i Google Sheets).</p>";
        return;
    }

    // Grouping Logic
    const groups = {};
    validData.forEach(row => {
      const rase = (row['rase'] || "").trim();
      const farge = (row['farge'] || "").trim();
      const key = farge ? `${rase} - ${farge}` : rase;
      
      if (!groups[key]) groups[key] = [];
      groups[key].push(row);
    });

    // Sort Groups Alphabetically
    const sortedKeys = Object.keys(groups).sort();

    sortedKeys.forEach(groupKey => {
      // Sort Dogs by Score (Desc)
      const dogs = groups[groupKey].sort((a, b) => Number(b['Poeng']) - Number(a['Poeng']));
      createTable(container, groupKey, dogs);
    });
  }

  // Function: Draw the Table
  function createTable(container, title, dogs) {
    const h2 = document.createElement('h2');
    h2.className = 'group-header';
    h2.textContent = title;
    container.appendChild(h2);

    const table = document.createElement('table');
    let html = `
      <thead>
        <tr>
          <th width="15%">Plass</th>
          <th width="15%">Poeng</th>
          <th>Hundens navn</th>
          <th class="hide-mobile">Reg. nr</th>
        </tr>
      </thead>
      <tbody>
    `;

    dogs.forEach((dog, index) => {
      const rank = index + 1;
      const rankClass = rank <= 3 ? `rank-${rank}` : '';
      const titles = dog['Hundens titler'] ? `<br><small style="color:#666">${dog['Hundens titler']}</small>` : '';
      const regNr = dog['Hundens reg. nr'] || '-';

      html += `
        <tr class="${rankClass}">
          <td>${rank}</td>
          <td><strong>${dog['Poeng']}</strong></td>
          <td>${dog['Hundens navn']} ${titles}</td>
          <td class="hide-mobile"><small>${regNr}</small></td>
        </tr>
      `;
    });

    html += `</tbody>`;
    table.innerHTML = html;
    container.appendChild(table);
  }
</script>